<!DOCTYPE html>
<html lang=ja>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset=utf-8>
  <!--
  貴様、見ているな！！
  このサイトの技術的なまとめはこちらをどうぞ。
  https://labs.jxck.io/blog

  by Jxck
  -->
  <link rel=canonical href="https://blog.jxck.io/entries/2018-11-10/dark-mode-via-prefers-color-scheme.html">
  <link rel=amphtml href="https://blog.jxck.io/entries/2018-11-10/dark-mode-via-prefers-color-scheme.amp.html">
  <link rel=alternate type=application/atom+xml title=blog.jxck.io href=/feeds/atom.xml>
  <link rel=author href=https://jxck.io/assets/humans.txt>
  <link rel=manifest href=/manifest.json>
  <link rel=preload as=font type=font/woff href=https://jxck.io/assets/font/NotoSansCJKjp-Jxck-Regular-201802.woff2 crossorigin>
  <meta name=viewport content="width=device-width,initial-scale=1">
  <script async src=https://jxck.io/assets/js/ga.js></script>
  <script async src=https://jxck.io/assets/js/highlight.min.js></script>
  <script async src=https://jxck.io/assets/js/sw.js></script>
  <script async src=https://jxck.io/assets/js/main.js></script>

  <meta name=author content=Jxck>
  <meta name=description content="macOS Mojava は OS レベルで Dark Mode に対応した。しかし、 Web コンテンツは依然として白背景黒文字ベースのデザインが多く、結果ブラウザの中だけ眩しいという問題がある。Safari TP69 では、これにメディアクエリで対応するための `pre...">
  <meta name=keywords content="media query,dark mode,css">

  <meta name=twitter:card content=summary>
  <meta name=twitter:site content=@jxck_>
  <meta name=twitter:url content="https://blog.jxck.io/entries/2018-11-10/dark-mode-via-prefers-color-scheme.html">
  <meta name=twitter:title content="prefers-color-scheme を用いた Dark Mode 対応と User Preference Media Features | blog.jxck.io">
  <meta name=twitter:description content="macOS Mojava は OS レベルで Dark Mode に対応した。しかし、 Web コンテンツは依然として白背景黒文字ベースのデザインが多く、結果ブラウザの中だけ眩しいという問題がある。Safari TP69 では、これにメディアクエリで対応するための `pre...">
  <meta name=twitter:image content="https://jxck.io/assets/img/jxck.png">

  <meta property=og:type content=article>
  <meta property=og:url content="https://blog.jxck.io/entries/2018-11-10/dark-mode-via-prefers-color-scheme.html">
  <meta property=og:title content="prefers-color-scheme を用いた Dark Mode 対応と User Preference Media Features | blog.jxck.io">
  <meta property=og:site_name content="blog.jxck.io">
  <meta property=og:description content="macOS Mojava は OS レベルで Dark Mode に対応した。しかし、 Web コンテンツは依然として白背景黒文字ベースのデザインが多く、結果ブラウザの中だけ眩しいという問題がある。Safari TP69 では、これにメディアクエリで対応するための `pre...">
  <meta property=og:image content="https://jxck.io/assets/img/jxck.png">

  <link rel="shortcut icon" href="https://jxck.io/assets/img/jxck.png">
  <link rel=icon sizes=256x256 href="https://jxck.io/assets/img/jxck.png">
  <link rel=icon sizes=60x60 href="https://logo.jxck.io/jxck.60x60.png">
  <link rel=icon sizes=1200x1200 href="https://logo.jxck.io/jxck.1200x1200.png">
  <link rel=apple-touch-icon sizes=256x256 href="https://jxck.io/assets/img/jxck.png">
  <link rel=apple-touch-icon sizes=60x60 href="https://logo.jxck.io/jxck.1200x1200.png">
  <link rel=apple-touch-icon sizes=1200x1200 href="https://logo.jxck.io/jxck.1200x1200.png">
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage":{
    "@type":"WebPage",
    "@id":"https://blog.jxck.io"
  },
  "headline": "prefers-color-scheme を用いた Dark Mode 対応と User Preference Media Features | blog.jxck.io",
  "image": [
    "https://jxck.io/assets/img/jxck.png",
    "https://logo.jxck.io/jxck.1200x1200.png"
  ],
  "datePublished": "2018-11-10T08:00:00+08:00",
  "dateModified": "2019-01-27T08:00:00+08:00",
  "author": {
    "@type": "Person",
    "name": "Jxck",
    "image": "https://jxck.io/assets/img/jxck.png"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jxck",
    "logo": {
      "@type": "ImageObject",
      "url": "https://logo.jxck.io/jxck.60x60.png",
      "height": 60,
      "width": 60
    }
  },
  "description": "macOS Mojava は OS レベルで Dark Mode に対応した。しかし、 Web コンテンツは依然として白背景黒文字ベースのデザインが多く、結果ブラウザの中だけ眩しいという問題がある。Safari TP69 では、これにメディアクエリで対応するための `pre..."
}
</script>

  <title>prefers-color-scheme を用いた Dark Mode 対応と User Preference Media Features | blog.jxck.io</title>
  <link rel=stylesheet property=stylesheet type=text/css href=https://jxck.io/assets/css/body.css>
</head>
<body>
  <link rel=stylesheet property=stylesheet type=text/css href=https://jxck.io/assets/css/header.css>
  <header>
    <nav>
      <ul>
        <li><a href=https://blog.jxck.io><img class=logo alt=blog title="blog top" width=30 src=https://jxck.io/assets/img/blog.svg></a>
        <li><a href="/entries/2018-11-10/dark-mode-via-prefers-color-scheme.amp.html#development=1" aria-label="amp version"><svg width=30 height=30><use xlink:href="/assets/img/amp.svg#main"/></svg></a>
        <li><a href=.><img alt=up title="move to parent directory" width=30 src=https://jxck.io/assets/img/up.svg></a>
        <li><a href=/feeds/atom.xml><img alt=rss title="rss feed" width=30 src=https://jxck.io/assets/img/rss.svg></a>
        <li><a href=https://jxck.io/humans.txt><img alt=humans title=huamns.txt width=30 src=https://jxck.io/assets/img/humans.svg></a>
        <li><a href=https://jxck.io><img class=logo alt=jxck title="jxck logo" width=30 src=https://jxck.io/assets/img/jxck.png></a>
      </ul>
    </nav>
  </header>

  <link rel=stylesheet property=stylesheet type=text/css href=https://jxck.io/assets/css/markdown.css>
  <link rel=stylesheet property=stylesheet type=text/css href=https://jxck.io/assets/css/main.css>
  <main>
    <link rel=stylesheet property=stylesheet type=text/css href=https://jxck.io/assets/css/info.css>
    <ul class=info>
      <li>created_at: <time class=created_at datetime=2018-11-10>2018-11-10</time>
      <li>updated_at: <time class=updated_at datetime=2019-01-27>2019-01-27</time>
      <li class=tags>tags: [<a href='/tags/media%20query.html'>media query</a>,<a href='/tags/dark%20mode.html'>dark mode</a>,<a href='/tags/css.html'>css</a>]
    </ul>

    <link rel=stylesheet property=stylesheet type=text/css href=https://jxck.io/assets/css/article.css>
  <article>
    <h1><a href=/entries/2018-11-10/dark-mode-via-prefers-color-scheme.html>prefers-color-scheme を用いた Dark Mode 対応と User Preference Media Features</a></h1>
    <section>
      <h2 id="intro"><a href="#intro">Intro</a></h2>
      <p>macOS Mojava は OS レベルで Dark Mode に対応した。
      <p>しかし、 Web コンテンツは依然として白背景黒文字ベースのデザインが多く、結果ブラウザの中だけ眩しいという問題がある。
      <p><a href="https://webkit.org/blog/8475/release-notes-for-safari-technology-preview-68/">Safari TP69</a> では、これにメディアクエリで対応するための <code translate="no">prefers-color-scheme</code> が実装された。
      <p>これを用いた DarkMode 対応と、本ブログの DarkMode 対応、および策定中の User Preference Media Features について解説する。
    </section>
    <section>
      <h2 id="update"><a href="#update">Update</a></h2>
      <p>2019/1 に Chrome の Intents が出された。
      <ul>
        <li>
          <a href="https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/Muw0N43ntSw/WZZZI7w7DQAJ">Intent to Implement: Media Queries: prefers-color-scheme feature</a>
        </li>
        <li>
          <a href="https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/NZ3c9d4ivA8/BIHFbOj6DAAJ">Intent to Implement and Ship: CSS prefers-reduced-motion media query</a>
        </li>
      </ul>
    </section>
    <section>
      <h2 id="dark-mode"><a href="#dark-mode">Dark Mode</a></h2>
      <p>多くのディスプレイコンテンツは、背景を白、文字を黒にしたデザイン(Light Mode)が多い。
      <p>しかし、暗い場所での閲覧時に目への負荷を下げる目的で、背景を黒、文字を白に反転したデザインが用意され、ユーザが好みで切り替えられるようにしたアプリケーションも増えた。
      <p>macOS Mojava らは、 OS レベルで Dark Mode を有効にできるようオプションが追加され、これによって多くのアプリケーションのデザインが切り替わるようになった。
      <p>筆者は黒背景のターミナル上に居る時間が長いため、ブラウザと切り替えた時の光の強さの変化がずっと気になっていたが、 OS 全体を Dark Mode にした結果より一層ブラウザが眩しく感じるようになった。
      <p>Safari は、 Mojava の Mode が Light/Dark どちらに設定されているかを取得する仕組みを検証しており、これを用いると OS の設定に合わせたデザインを提供できる。
    </section>
    <section>
      <h2 id="prefers-color-scheme"><a href="#prefers-color-scheme">prefers-color-scheme</a></h2>
      <p>Safari TP 69 では、 <code translate="no">prefers-color-scheme</code> を用いて Media Query でテーマごとに分岐した CSS を記述できるようになった。
      <link rel=stylesheet property=stylesheet type=text/css href=/assets/css/pre.css>
      <pre class=css><code translate="no">@media (prefers-color-scheme: light) {
  background-color: white;
  color: black;
}

@media (prefers-color-scheme: dark) {
  background-color: black;
  color: white;
}</code></pre>
      <p>多くの場合、現状のコンテンツが Ligth Mode と見なされるだろう。
      <p>その場合、差分のみを Dark Mode 用に書き、色を反転するデザインをあてれば良い。
      <p>しかし、今後 Dark 以外のテーマの出現や汎用性、メンテナンス性を考えると、カラーセットを Variables でまとめておき、切り替えるのが良いだろう。
      <pre class=css><code translate="no">@media (prefers-color-scheme: light) {
  --theme-base: white;
  --theme-font: black;
  --theme-accent: red;
}

@media (prefers-color-scheme: dark) {
  --theme-base: white;
  --theme-font: black;
  --theme-accent: red;
}

body {
  background-color: var(--them-base);
  font: var(--them-font);
  strong: var(--them-accent);
}</code></pre>
    </section>
    <section>
      <h2 id="user-preference-media-features"><a href="#user-preference-media-features">User Preference Media Features</a></h2>
      <p>この <code translate="no">prefers-color-scheme</code> は MediaQueries Lv5 の User Preference Media Features という仕様に含まれ、まだ策定途中である。(current work は Lv4)
      <p>主に、ユーザ自身が望ましい閲覧設定を、コンテンツ側が取得して、デザインのヒントに利用するためのものである。
      <p>執筆時点では、 User Preference Media Features は以下の 4 が定義されている。
      <ul>
        <li>prefers-reduced-motion(reduce):       アニメーションなどの動きを減らす
        <li>prefers-reduced-transparency(reduce): 透過表現を減らす
        <li>prefers-contrast(high, low):          コントラストの高低を要求する
        <li>prefers-color-scheme(light, dark):    カラーテーマを指定する
      </ul>
      <p><a href="https://drafts.csswg.org/mediaqueries-5/#mf-user-preferences">Media Queries Level 5</a>
      <p>今回はこの color-scheme にのみフォーカスしたが、この仕様を見ればユーザが様々な閲覧環境を設定できるようになる可能性が想定でき、対応のバリエーションも増えるだろう。
      <p>もし今回 DarkMode に対応するために CSS に手を入れたり、新規に CSS を書く機会があるのであれば、将来こうした設定への対応をする可能性を考慮し、設計できるとより良いのではないだろうか。
    </section>
    <section>
      <h2 id="本サイトでの適用"><a href="#本サイトでの適用">本サイトでの適用</a></h2>
      <p>本サイトも色関連を variables でまとめ、 dark mode のみ切り替えるように CSS を適用した。
      <p>動作は Safari TP69 で確認している。
      <p>
        <picture>
          <source type=image/webp srcset=./dark-mode.webp#1346x783>
          <img lazyload src=./dark-mode.gif#1346x783 alt="dark mode support demo" title="">
        </picture>
      </p>
      <p>今後、新しくプロパティが実装された際には対応していく予定であり、それを見据えた CSS のリファクタリングをし、備えておきたいと考えている。
    </section>
  </article>

  </main>
  <hr>

  <link rel=stylesheet property=stylesheet type=text/css href=https://jxck.io/assets/css/footer.css>
  <footer>
    <p class=copyright><small>Copyright &copy; 2016 <a href=/>Jxck</a>. All Rights Reserved.</small><small>Using <a href=https://www.google.com/intl/ja/policies/privacy/partners/>Google Analytics</a> and <a href=https://w3c.github.io/ServiceWorker/>Service Worker</a>.</small></p>
  </footer>
</body>
</html>