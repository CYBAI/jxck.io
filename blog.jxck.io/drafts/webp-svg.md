# WebP と SVG を中心としたサイト構成

画像の最適化戦略と WebP & SVG

画像は Web におけるコンテンツの中でも非常に支配的なサイズになるため、画像周りの最適化は非常に重要になる。

特に画像の場合は用途に応じて

- フォーマット
- 表示サイズ
- 解像度

などを起点に戦略をたてていく。

# フォーマット

このサイトでは以下を使う

- svg
- png
- jpeg
- gif
- webp

## SVG

アイコンなどのツールチップには  png なども使われるが、このサイトでは基本的に SVG を利用している。

ベクタにすることで、画面サイズや拡大率などに関わらずなめらかな画像を表示することができる。

またソースとなる XML はテキストであるため、 gzip 圧縮による効果もデカイ。

ツールなどで書いた SVG のソースは複雑なパスになり見た目が変わらないにも関わらずサイズが肥大する場合がある。
簡単なもの、このサイトで言えば右上の RSS, AMP のアイコンは最小のものになるよう手書きした。

また、このサイトは見た目が Markdown ライクになるように CSS を作っているが、そこ付与される文字を before/after 擬似要素への content で、文字を指定することでフォントデータを使って装飾している。

これは簡易 font-awesome のような構成であり、マシンローカルのベクタデータを流用しているイメージになる。

## WebP

PNG, JPEG 両方の用途で代替として検討できる。

このフォーマットを使うだけで、画質を犠牲にせずかなりのサイズ削減が期待できる。

WebP アニメーションを使えば GIF アニメよりも色数が多く綺麗なアニメーションを作ることができる。
WebP は WebM の1フレームが基本なため、つまり WebP アニメーションは簡易 WebM と言っても良い。
ちょっとしたスクリーンシェアなどには重宝する。

しかし対応してないブラウザのためには代替として PNG, JPEG などにフォールバックできるように、後述の srcset で選択肢として提示し、ブラウザに選ばせている。

## サイズ戦略

画像において最も無駄なのは、大きいサイズの画像を小さく表示している場合である。
これはネットワークでの転送上も、ブラウザのレンダリング上もオーバーヘッドになる。
サイズが大きいということはデータが多いため、リサイズして表示するサイズぴったりに加工できればデータ量も最適となる。
また、見た目上の劣化が生じなければ、減色などの最適化も考えられるが、ここではまずサイズにフォーカスする。


PC ブラウザを対象にするのであれば、基本的には表示するピクセルサイズにリサイズすれば良い。
問題はモバイルのブラウザの挙動にある。

### 縮小

