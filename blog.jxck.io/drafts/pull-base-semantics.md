# [semantics][web] Pull 型のセマンティクスと Push 型のセマンティクス



|          | 標準 | 非標準 |
|:---------+:-----+:-------|
| 実装あり | pull | push   |
| 実装なし | pull | x      |



- push: ClientHints で出し分け
- pull: picture/sources




## Intro

セマンティクスを Push 型で考えることの弊害と、そもそもセマンティクスはどうあるべきかという筆者の考えについてまとめる。


## セマンティクスとシンタックス

あるデータ(コンテンツでも良い)を機械可読にする場合、その仕様にはシンタクスとセマンティクスの二つが定義される。

HTML の場合、例えば以下のような HTML は、 **シンタクス** として正しい。

```html
<span>セマンティクスは Pull 型であるべきだという話</span>
```

しかし、この HTML がコンテンツの中で意味として正しいかというと、そうではない。
この文がタイトルであるのであれば、以下のようにするのがセマンティクスとして正しいということになる。


```html
<title>セマンティクスは Pull 型であるべきだという話</title>
```

シンタクスとしての正しさは、機械的に検証することが比較的に容易だ。
しかし、セマンティクスが正しいことを、機械的に判断することは難しい。

ではなぜ、この記事のタイトルとなるものは、 `<span>` ではなく `<title>` とマークアップすべきなのだろうか?


## セマンティクスの使われ方

`<title>` タグが現状どう使われているか、実例をあげてみよう。

多くのブラウザにおいては、タブに現在表示しているページの `<title>` を出す。
ブックマークする際の名前や、検索履歴にも表示されるだろう。

SNS に URL を投稿すれば、取得した結果から `<title>` を抜き出し表示してくれるかもしれない。

はてブや Slack でも、同様に消費されている場合がある。

では、そのコンテンツのタイトルを `<title>` タグでマークアップするのは、 はてブや Slack や Twitter や FB の **ため** だろうか。

そう思ってコンテンツを作っている人ももしかしたらいるかもしれない。

しかし、タイトルを `<title>` としてマークアップする理由は簡単だ。それがタイトルだからだ。


そんな当たり前のことわかってると思うかもしれないので、他の例を出してみよう。


## コンテンツとセマンティクス

HTML のセマンティクには、そのコンテンツの裏にあるメタ情報を、コンテンツと紐づける役割がある。

それが機械可読である状態になっていることで、文字通り機械がその情報を消費できる。

ここでいう機械とは、 Web においては User Agent と呼ばれることが一般的だ。

Web はまず User Agent に消費される。ここで重要なのは、その先に **人間がいるとは限らない** ところにある。

例えば Form の中にメールアドレスを入力する `input` タグがあるとしよう。入力された値は JS によってサーバに送られている。

シンタックスとしては以下は正しい HTML だ。


```html
<p>メールアドレス</p>
<input type=text>
```


人間が、ブラウザを通してこの **コンテンツ** を消費する場合、恐らくこの入力欄にメールアドレスを入れればいいということは容易にわかるだろうし、それは JS によって正しく処理され動いているかもしれない。

しかし、 UA として間に挟まるブラウザは、ここが何を入力されるかを知ることはできない。

コンテンツとしては正しいかもしれないが、以下のようにすると UA はより正確にコンテンツの中身を把握することができる。


```html
<label for=email>メールアドレス</label>
<input id=email type=email name=email>
```


CSS/JS 次第では、見た目は全く変わらない上に、機能として全く同じように動くという点で、人間にとっては全く同じコンテンツかもしれない。
しかし、 UA がより正確に内容を把握できる。


この記事の読者は、これによってブラウザがどう挙動するかの知識があるかもしれない。

しかし、























## コンテンツとメタデータ
## 実利とコストの話

しかし Web は基本的にコンテンツを提供することを目的として作られるだろう。

コンテンツにこそ価値がある。

セマンティクスの整備は、そのコンテンツを取りコンテキストを、メタデータを用いていかに正確に機械可読にするかという目的がある。

では、それをどこまでやるかという問題が出てくる。

セマンティクスを中立にするなら、 HTML の id や class 属性も CSS や JS 、ブラウザの特定の挙動「のためにだけ」あるものでは無いと言えるだろう。

そもそも id はドキュメントの中での一意性を表し、 class は共通する性質があることを表す。

そうした性質を見つけ出し、全てのタグに付与することは論理的には可能だ。しかし、そのコストは膨大だろう。そこまでやると、コンテンツが肥大してパフォーマンスという別軸のデメリットが生まれるかもしれない。

シンタックス上定義された全てのものを記述するべきというわけにはいかないだろう。

コンテンツの価値に寄与しないならばコストがペイしないからである。


















例えば以下のようなコードがあったとする。

```
<img src=graph.png>
```

このコードに対して、あなたはレビューで以下のように指摘したとする。

> `<img>` には `alt` に代替テキストをつけるべきです

これにたして

> なぜですか？

と聞かれたら、あなたはなんと答えるだろうか？


## alt はスクリーンリーダーのため(だけ)ではない

一番最初に浮かぶ返答は、スクリーンリーダーだろう。

最近は a11y 関連の啓蒙も進み、その一例として low vision ユーザのスクリーンリーダー利用を想定した指摘は有効かもしれない。

> alt が有れば画像を見ることができないユーザに、代替テキストを読み上げで提供できる

こうした指摘は、適切だと思う。そこに異論はない。

しかし、この認識がいつの日か「画像に `alt` をつけるのは a11y のためである」とすり替わって、浸透していないかは少し疑問を抱いている。

では、思考実験として、このレビュー相手が以下のようにコメントをした場合を考えてみよう。

> スクリーンリーダーは基本的に上からテキストを読んでいくと思います。であれば、画像の上に「次の画像は xx についてのグラフです」と書いた方が親切ではないでしょうか？

あなたは、この問いに対してなんと返すだろうか？


## 

`<img>` というタグは、画像(image)のマークアップに利用される。

`alt` はそのタグの属性として定義されているため、そのタグにおけるメタデータの表現に利用するものである。

そして、 img でマークアップすることの意味、 alt でメタデータを付与した場合、それらが何を意味するか、は HTML の仕様で定義されている。

しかし、その用途は、厳密には HTML の仕様の範囲ではない。

もちろん、代表的な用途として「スクリーンリーダーが読み上げることができる」というようなユースケースが例示されていたとしても、それはあくまで例示だ。


セマンティクスの責務の範囲は、「このシンタックスで記述されたものは、こういう意味を持つ」という範囲であるのが基本だ。

その意味を「どう使うか」は、本来 User Agent の自由なのだ。


提供する側は、常に実装ではなく仕様を拠り所にするべきなのだ。


##

`<img>` が alt を持っているということを実際に利用しているユーザエージェントを上げてみよう。

- ブラウザが、画像が読めなかった場合に、代わりにテキストを表示する
- スクリーンリーダーが画像表示の代わりに読み上げる
- 検索サービスが、その画像がなんであるかの補助情報として、検索キーワードなどに利用する


HTML が定義したセマンティクスが


そして、 HTML の中に alt 以外にも id, class, title など多くのメタデータがある。




## 

同じことは別の属性でも言える。

例えば id は、主に css の指定粒度や、 JS からの DOM 取得などに使われる。
しかし、実際には ID を振る理由は、 CSS や JS のため **だけ** ではない。

<!--
ドキュメントの適切な場所に、一意な識別子を振るのが目的だ。
そこに一意な識別子があるから、ドキュメント中に一意な識別子が欲しいユーザエージェントは、その意味を自身の実装の中で利用することができる。
ハッシュを使ったリンクが作れるのも、そこに一意な識別子があるからだ。
-->


title をつければ、ブラウザはツールチップを表示する。
しかし、 title をつけるのはツールチップを表示するため **だけ** ではない。


h1 タグで大見出しをマークアップすれば、それはサーチエンジンに使われるかもしれないが、
大見出しを h1 タグでマークアップするのは、サーチエンジンのため **だけ** ではない。



## GET で削除する弊害

Web のセマンティクスはなにも HTML だけで完結しているわけではない。

例えば、 HTTP には method が用意されており、それぞれが意味を持っている。

GET はリソースの取得だ、なのに GET でリソースの削除を行うのは、 Web として間違っている。

コメント欄横に削除をリンクをつけ、クリックしたら削除するという実装は、 Google Bot が訪れて片っ端から link を踏みコメントを全部消し去って行ったという笑い話につながるわけだ。

しかし GET で削除を行ってはいけないのは、 Google Bot が来ても大丈夫にするためではない。単に HTTP の使い方を間違っており、 Web として正しくないからだ。


## form のセマンティクス

form は、 UA がサーバに対して情報を提供する手段として用意されている。
どの URL に対してどの情報を、どういう形式でどう送るか。これらを HTML で定義することができる。

HTML に書かれた情報を元に UA は、その挙動を実現する訳だが、これら挙動自体は JavaScript を使って提供することも決して不可能ではない。

単に `<input type=text>` と `<button>` でもあれば、あとはそれらのフォーカスとクリックをフックすればいい。
入力したいものがパスワードなら、 onkeydown などでフックしメモリに保存してからら表示は  `・` に置き換えればいいし、
button の `onclick` をフックして、それを POST なりなんなりで送ればいい。
同じ挙動を再現することは不可能ではないだろう。

しかし、そこには本来 form が提供していたセマンティクスが一切ない。
`type=password` によってそこに入力されたものがパスワードであり、 `type=submit` がクリックされたときにそのパスワードが確定していることに依存して、ワンパスワードやブラウザのクレデンシャルマネージャは、パスワードをサイト(action=url)と紐づけて保存している。



## 目的と手段を逆転することによって起こる問題

例えば lang 属性は、そのコンテンツがどの言語で書かれているかを表現する。

したがって、そのコンテンツがどういう言語で書かれているかを知りたい User Agent は、そのコンテンツがどんな性質のものであるかに関わらず、そのメタデータを利用することができる。

もしこれが、「スクリーンリーダーが読み上げる言語を選択するために使う」というユースケースを先に考えると、そのサイトが iPhone Safari をターゲットにしたサイトだった場合は、 Voice Over がその設定を無視してユーザが設定した言語での読み上げを行う場合、「設定しても無駄」ということになるかといえばそうではない。

その属性に適切な言語が設定されていることを求める User Agent は iPhone の Voice Over 以外にもあるだろう。

「それは具体的になんだ？」という問いがあるなら、それこそがセマンティクスを Push で考えている証拠である。


User Agent の実装は変化する。今ある User Agent だけを見て対応を決めるなら、まだ見ぬ User Agent が出てきたときに、「その UA への対応」としてコンテンツの修正が必要になるだろう。

しかし、多くのコンテンツは修正されない。そして、まだ見ぬ User Agent はコンテンツ管理者の目に止まるとは限らない。

まだ見ぬ User Agent が何を見るかというと HTML の仕様に準拠するしかない。そのコンテンツがどんな言語で書かれているかを知る方法は。



##

Web にはセマンティクスが定義されている。

Web で何かを作るときに、そのセマンティクスを正しく提供するコンテンツを作ることは、決して「何か特定の User Agent の挙動のため」ではない。

それが「Web として正しい」からだ。

それ以外に理由なんて、本来は必要ない。

セマンティクスは「何かのためにそうする(Push)」ではない。

それが、 Web というルールに則って実装された不特定多数の User Agent によって正しく消費(Pull)されるようにしておかなくてはならない。


## 正しさに金は出ない

`<img>` に alt をつける理由は、「それが Web として正しい」からだ。

本来それ以上の説明は必要ない、実際の UA の挙動を見せて説得する必要も本来ないはずだった。


でも「正しさ」は伝わらない。実際このエントリだって奇異の目で見られるだろう。

ましてや、そこに金は出ない。「正しくするため」で alt をつけて回る工数は、多くの場合認められないだろう。

だから、「Web として正しくない」ために、不具合が生じている具体的な場面を説明する必要にかられる。

そこで、具体的な事例としてわかりやすいのが a11y や SEO だ。

それらは、ユーザの数だったり、広告収入だったりという具体的な数字で響いいてくるため、対応する価値が生まれる。

WCAG は、「正しくないことで生じる不具合」を集めた事例と言える。だからその対応策のほとんどは、よく読めば「Web として正しくしよう」というものだ。


## まだ見ぬ不具合を未然に防ぐために

`img` に alt をつける工数を捻出するために、 a11y を例に出すのは効率的だ。筆者はそれを否定しない。

しかし、決して 「`img` に alt をつけるのは a11y のためだ」と思い込んでしまうのには気をつけたい。

`img` に alt がないと困るのは、スクリーンリーダーだけでない。

画像検索エンジンや、画像が読み込めなかったブラウザだけでもない。

まだ自分が知らない User Agent 、今はまだ存在すらしていない User Agent であってもそうだ。

Web を取り巻く全てのエコシステムの中で、 **画像の代替テキストが知りたいと思うすべての User Agent** が、等しくその情報を消費できるように `img` には `alt` があるのが正しいというだけなのだ。

これは別に `<img>` の alt だけに止まらない。 title も lang も。 id も class も。文書全体が適切な見出し(h1, h2...)と、適切な `<section>` によって構造化されていることも。その全体に正しい `<title>` がついていることも。


これら全て、それが Web として正しいからであって、何か特定の UA の特定の挙動のために作り込む訳ではない。

もちろんターゲットとなる UA の、特定の挙動を問題視して、 HTML の仕様から外れる特殊な対応を余儀なくされる例外的場面は腐る程ある。


しかし意識の上で、セマンティクスは Push ではなく Pull 型であるべきであり、 Web として正しくないものを正しくする理由にユースケースを出すのは、素人を説得するためだと思っていたい。





















## Intro

セマンティクスが先にあって、それがエコシステムに「消費(Pull)」されるべきはずが、
特定のツールなどに対して「提供(Push)」するべきものとして捉えるのは、
先々あまり良くないこともあるよという話。


## なぜ Table レイアウトはダメなのか?

もっと極端な例をあげるなら、かつて使われていた Table レイアウトがある。

これは、まだ grid も flexbox もなく、 float の挙動すら怪しかった時代、画面全体を一つの大きな `<table>` にして、縦横のセクション分離を `<td>` などで行う手法のことだ。

筆者はこれを実装はしたことはないが、特に初期ガラケー対応時代には、良く使われた手法であったと聞いている。

Web においては、典型的なアンチパターンのひとつと言えるだろう。

では、なぜこれはダメだったのだろうか。


これも a11y 的な問題の指摘で片付けられてしまうことが多いが、端的に言えば **Web として間違っているから** で良いと思う。

`<table>` には表をマークアップされたものに、表であるという意味を持たせる力がある。

表は一般的に、複数の列でカテゴライズされたデータが、行の単位で連続して存在する。列にはヘッダがあり、表全体にはキャプションがあり、、、

こうしたルールを表現する方法が全てあるため、























































# [semantics][web] Web のセマンティクスは Pull 型であるべきという話

## Intro

セマンティクスは、そこに静かに佇んでいて、欲するものに対して等しく提供されるべきという話


## 画像に alt をつけるのは誰のためか?

よく、画像に `alt` をつけるのは「スクリーンリーダーのためである」とか、 `<meta name="description">` を書くのは SEO のためである、という説明を見る。

確かにそうした効果はあるだろう、しかし本来はベクトルが逆だということも認識しておきたい。

本来画像に `alt` をつけ、そこに代替テキストを入れるのは、「それが Web として正しいから」だ。

Web で画像を扱う場合は代替画像を付与するというルールが Web にはあり、そのための構文が定義されている。

Web のエコシステムは、画像を扱う場面で、そこに代替テキストが定義されていることを「利用する」ことができる。

スクリーンリーダーや、画像検索エンジンや、ブラウザが画像を読めなかったときにそれを表示するのは、

画像には代替テキストがあるというセマンティクスがあるからだ。

Web が Web として正しく作られていれば、エコシステムはその仕組に則ることができる。

セマンティクスとは、何か特定のツールやユースケースに対して、そこに向けるために用意する Push 型で語られがちだが、

本来は、こうあるべきという正しい姿でそこにあり、それを必要とする周辺のツールが、自身の都合に合わせてそれを利用する Pull 型であるべきだ。


## 正しさに金は出ない

しかし、もし画像に代替テキストがついてないような、残念なコンテンツをみつけてしまっても

多くの場面で「Web として正しい、あるべき状態に治そう」という話では金は出ない。


そこで、現実的には「これでは a11y 的に問題がある」とか「SEO の効果が落ちる」みたいな理由を拝借する。

これは、 Push 型のモチベーションの方が、目的がわかりやすく効果も計測しやすいからだ。

ゴールも、その特定のツールやユースケースへの対応を確認することで、完了と言える。


「Web が正しくなかった結果出る歪」に名前をつけて、それを逆手に取るのは、多くの場面で行われる。


## 正しければ出なかった問題

逆を言えば、先に上げた a11y や SEO は「Web が正しくなかった結果出る歪」が多く含まれている。

WCAG を見れば、そこにかかれた殆どは、単に Web におけるアンチパターンが書かれていることがわかる。

SEO だって突き詰めれば、コンテンツの中に適切な情報が適切に書かれていれば、あとはそれを bot が見ているにすぎない。


しかし、より積極的に適応しないといけない場面がある。

そこまでいった場合に出ている問題の殆どは、個々のツールやユースケースが過剰に要求する何かや、
それらが Web を正しく扱えてない場合におこる何かへの個別対応がほとんどだ。







## Pull 型でないと困ること

特定のツールやユースケースに対して、「対応策」として Push 型の実装を行う


















<img src=”jxck.png”>
























セマンティクスは Pull 型であるべきだ
#
