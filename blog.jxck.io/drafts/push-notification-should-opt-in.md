# Service Worker の Push Notification を Opt-In にすべき理由と実装パターン

## Intro

Serivce Worker での Push Notification を提供するサイトも増えてきた。

しかし、実装方法によってはサイトを開いたら突然ダイアログでパーミッションを求められ、ユーザの体験としては良いものではない。

また、そこでユーザがブロックを選択した場合は、そのドメインからユーザに Push を送ることが一切できなくなる。

そこから、ユーザ操作によって再度許可を与えるのは、あまり現実的ではない。

それらを踏まえて、 Push Notification の実装のあり方と、本サイトへの適用について記す。


## Push Notification の問題点

Push Notification を愚直に実装した場合、以下のようなコードが考えられる。


TODO


しかし、これではユーザに対して突然許可を求めるダイアログが表示されることになる。

良くわからないダイアログが出たら、ブロックするユーザも多いだろう。


## ドメインレベルでのブロック

ブロックはドメインレベルで適用される。

つまり、そのユーザには、そのドメインから一切の通知を送ることができなくなる。

もし通知を前提としている、もしくは通知への依存が強いタイプのサービスであれば、要するにドメインが死ぬ。


## ブロックを解除する難易度が高い

ブロックはユーザの操作によって解除することが可能だ。

具体的には以下のように行う。


TODO: すくしょ Chrome/Firefox


これは一般ユーザにとっては敷居が高い


## 通知へのオプトイン

## サイト内 Notification の代用

ページを開いているのなら、 Push の Notification をわざわざ出す必要も無い。

ページの内部の UI を工夫することで通知を表現することは十分可能。


## 通知内容の厳選

## ブロック解除への導線

## 本サイトへの適用



