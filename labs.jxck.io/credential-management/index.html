<!DOCTYPE html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">

<title>Credential Management API DEMO | labs.jxck.io</title>

<style>
</style>

<h1>Credential Management API DEMO</h1>

<form id=login method=POST>
  <label for=id>id</label>
  <input id=id type=text name=id placeholder=username autocomplete=username />

  <label for=password>password</label>
  <input id=password type=password name=password placeholder=current-password autocomplete=current-password />

  <input type=hidden name=csrf_token value="******" />

  <button type=submit>ok</button>
</form>

<p><a id=signin href=/>signin</a>
<p><a id=signout href=/>signout</a>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    if (navigator.credentials === undefined) return console.log('navigator.credentials unsupported')

    const $form = document.querySelector("#login")
    $form.addEventListener("submit", async (e) => {
      console.log(e.target)
      e.preventDefault()

      const credential = new PasswordCredential(e.target)

      try {
        const e = await navigator.credentials.store(credential)
        console.log(e)
      } catch (err) {
        console.log(err)
      } finally {
        console.log('signin')
      }
    })
  })

  document.addEventListener('DOMContentLoaded', async () => {
    const $signin = document.querySelector('#signin')
    $signin.addEventListener('click', async (e) => {
      e.preventDefault()

      const cred = await navigator.credentials.get({
        password: true
      })
      console.log(cred)
    })
  })

  document.addEventListener('DOMContentLoaded', async () => {
    const $signout = document.querySelector('#signout')
    $signout.addEventListener('click', async (e) => {
      e.preventDefault()
      navigator.credentials.preventSilentAccess()
    })
  })

  // prevent SilentAccess すると、状態が保存できるので
  // mediate を指定するよりもこっちの方が保存しやすい
</script>
