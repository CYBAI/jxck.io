# [erlang][gen_statem] gen_fsm から gen_statem へ

## Intro

Erlang/OTP 19 から、 gen_fsm の後継として gen_statem が導入された。

OTP の内部でも ssl などはすでに gen_statem に移行している。

このビヘイビアの概要について記す。


## 注意

すでにかなり安定はしているが、軽微といえども非互換な変更が OTP 20 以降に発生する可能性があることがドキュメントに言及されている。

本記事は、 19 時点での API ドキュメントをベースにしている。


## State Machine

特にサーバのようなプログラムでは、状態の管理が重要になる。
gen_server でも、状態を引数に保持し、パターンマッチで状態遷移を表現することはできる。

しかし、現在の状態(S)と、発生したイベント(E)の組み合わせによって、実行する処理(A)と次の状態(S')を以下のようにモデル化した場合、

```erlang
State(S) x Event(E) -> Actions(A), State(S')
```


これを実装する上では、 gen_server で汎用イベントを分岐して処理すると、コードは複雑になる。

そこで、状態(S)を関数名とし、イベント(E)をパターンマッチで明示的に表現する gen_fsm ビヘイビアを用いて実装されることが多かった。

gen_statem は gen_fsm と使用感は近く、これに機能を追加したような印象である。




